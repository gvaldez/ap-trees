### 7.2 ğŸ”² MÃ³dulo de Vista de CuadrÃ­cula (CORE)

> **ğŸ’¡ Funcionalidad inspirada en el mÃ©todo tradicional de hoja cuadriculada**, digitalizada para visualizaciÃ³n rÃ¡pida del estado de toda la finca.

Este mÃ³dulo es el **corazÃ³n visual del sistema**, permitiendo ver el estado de cada Ã¡rbol en una cuadrÃ­cula interactiva de filas y columnas. Es la herramienta mÃ¡s usada por los ingenieros agrÃ³nomos para identificar rÃ¡pidamente problemas y tomar decisiones.

#### Concepto Visual Mejorado

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”² VISTA DE CUADRÃCULA - Lote A                                â”‚
â”‚  Sector Norte - Aguacate Hass - PlantaciÃ³n 2019                 â”‚
â”‚  ğŸ“… Fecha: 2025-12-08 14:35 | ğŸ›°ï¸ Ãšltima actualizaciÃ³n: 2025-12-07â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Modo: [Estado de Salud â–¼]  Fecha: [2025-12-08 â–¼]  [Filtrosâš™ï¸] â”‚
â”‚                                                                 â”‚
â”‚        Colâ†’  1    2    3    4    5    6    7    8    9   10    â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ Fil 1â”‚  ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¡   ğŸŸ¡   ğŸ”´   ğŸ”´   ğŸŸ¢   ğŸŸ¢        â”‚ â”‚
â”‚ Fil 2â”‚  ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¡   ğŸŸ¡   ğŸ”´   ğŸ”´   ğŸŸ    ğŸŸ¢   ğŸŸ¢        â”‚ â”‚
â”‚ Fil 3â”‚  ğŸŸ¢   ğŸŸ¢   ğŸŸ¡   ğŸŸ¡   ğŸ”´   ğŸ”´   ğŸŸ    ğŸŸ    ğŸŸ¢   ğŸŸ¢        â”‚ â”‚
â”‚ Fil 4â”‚  ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¡   ğŸŸ    ğŸŸ    ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢        â”‚ â”‚
â”‚ Fil 5â”‚  ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢        â”‚ â”‚
â”‚ Fil 6â”‚  ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢        â”‚ â”‚
â”‚ Fil 7â”‚  ğŸŸ¢   ğŸŸ¢   ğŸ”µ   ğŸ”µ   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ£   ğŸŸ£        â”‚ â”‚
â”‚ Fil 8â”‚  ğŸŸ¢   ğŸŸ¢   ğŸ”µ   ğŸ”µ   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ£   ğŸŸ£        â”‚ â”‚
â”‚ Fil 9â”‚  ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢        â”‚ â”‚
â”‚Fil 10â”‚  ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢   ğŸŸ¢        â”‚ â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“Š RESUMEN                                                     â”‚
â”‚  Total: 100 Ã¡rboles                                             â”‚
â”‚  ğŸŸ¢ Saludables (SAL): 74 (74%)                                  â”‚
â”‚  ğŸŸ¡ ObservaciÃ³n (OBS): 6 (6%)                                   â”‚
â”‚  ğŸŸ  Riesgo (RIE): 5 (5%)                                        â”‚
â”‚  ğŸ”´ CrÃ­tico (CRI): 5 (5%)                                       â”‚
â”‚  ğŸ”µ En tratamiento (TRA): 4 (4%)                                â”‚
â”‚  ğŸŸ£ En recuperaciÃ³n (REC): 4 (4%)                               â”‚
â”‚  âš« Muerto (MUE): 2 (2%)                                        â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ ALERTAS AUTOMÃTICAS                                         â”‚
â”‚  ğŸ” Posible foco de Phytophthora en zona [F1-3, C5-8]          â”‚
â”‚     â†’ 5 Ã¡rboles crÃ­ticos agrupados                              â”‚
â”‚     â†’ RecomendaciÃ³n: AplicaciÃ³n urgente de fungicida           â”‚
â”‚  ğŸ” PatrÃ³n de estrÃ©s hÃ­drico en Fila 7                         â”‚
â”‚     â†’ Verificar sistema de riego                                â”‚
â”‚                                                                 â”‚
â”‚  [Ver Mapa ğŸ—ºï¸] [Comparar Fechas ğŸ“Š] [Exportar ğŸ“¥] [Imprimir ğŸ–¨ï¸]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Modos de VisualizaciÃ³n

| Modo | DescripciÃ³n | Esquema de Color | ActualizaciÃ³n |
|------|-------------|------------------|---------------|
| **Estado de Salud** | Estado general del Ã¡rbol | 9 estados (SAL, OBS, RIE, CRI, TRA, REC, MUE, REM, NUE) | Manual + IA |
| **Etapa FenolÃ³gica** | Fase de desarrollo actual | Por cultivo (ej: REP, BRO, FLO, CUA, MAD, COS) | Manual |
| **NDVI** | Vigor vegetativo | Gradiente continuo (0.0-1.0) | Drone/SatÃ©lite |
| **NDRE** | Ãndice red-edge | Gradiente continuo | Drone multiespectral |
| **ProducciÃ³n** | Rendimiento por Ã¡rbol | kg: bajo (<50) amarillo, medio (50-100) verde, alto (>100) azul | Manual |
| **Edad del Ãrbol** | AÃ±os desde siembra | Gradiente temporal | AutomÃ¡tico |
| **Ãšltima InspecciÃ³n** | DÃ­as desde Ãºltima revisiÃ³n | Gradiente temporal (verde <7d, amarillo <14d, rojo >14d) | AutomÃ¡tico |
| **Riesgo de Plagas** | Probabilidad de infecciÃ³n | Calculado por IA | AutomÃ¡tico diario |
| **EstrÃ©s HÃ­drico (CWSI)** | Nivel de estrÃ©s por agua | Gradiente: azul (sin estrÃ©s) a rojo (estrÃ©s alto) | CÃ¡mara tÃ©rmica |
| **ProgramaciÃ³n Cosecha** | Ãrboles listos para cosechar | Verde (listo), amarillo (prÃ³ximo), gris (no listo) | FenologÃ­a + dÃ­as |

#### Esquemas de Color Configurables (TypeScript)

```typescript
// Modo: Estado de Salud
type EstadoSalud = 'SAL' | 'OBS' | 'RIE' | 'CRI' | 'TRA' | 'REC' | 'MUE' | 'REM' | 'NUE';

interface EsquemaColorSalud {
  [key: string]: {
    color: string;
    emoji: string;
    nombre: string;
    descripcion: string;
  };
}

const COLORES_SALUD: EsquemaColorSalud = {
  'SAL': { 
    color: '#22c55e', 
    emoji: 'ğŸŸ¢', 
    nombre: 'Saludable',
    descripcion: 'Ãrbol sin problemas detectados'
  },
  'OBS': { 
    color: '#eab308', 
    emoji: 'ğŸŸ¡', 
    nombre: 'ObservaciÃ³n',
    descripcion: 'Requiere monitoreo cercano'
  },
  'RIE': { 
    color: '#f97316', 
    emoji: 'ğŸŸ ', 
    nombre: 'Riesgo',
    descripcion: 'Problema detectado, requiere acciÃ³n pronto'
  },
  'CRI': { 
    color: '#ef4444', 
    emoji: 'ğŸ”´', 
    nombre: 'CrÃ­tico',
    descripcion: 'Requiere atenciÃ³n inmediata'
  },
  'TRA': { 
    color: '#3b82f6', 
    emoji: 'ğŸ”µ', 
    nombre: 'En Tratamiento',
    descripcion: 'AplicaciÃ³n o intervenciÃ³n en curso'
  },
  'REC': { 
    color: '#a855f7', 
    emoji: 'ğŸŸ£', 
    nombre: 'RecuperaciÃ³n',
    descripcion: 'Mejorando tras tratamiento'
  },
  'MUE': { 
    color: '#1f2937', 
    emoji: 'âš«', 
    nombre: 'Muerto',
    descripcion: 'Ãrbol no recuperable'
  },
  'REM': { 
    color: '#9ca3af', 
    emoji: 'âšª', 
    nombre: 'Removido',
    descripcion: 'Ãrbol eliminado fÃ­sicamente'
  },
  'NUE': { 
    color: '#84cc16', 
    emoji: 'ğŸŸ¢', 
    nombre: 'Nuevo',
    descripcion: 'Plantado recientemente'
  }
};

// Modo: Etapa FenolÃ³gica (ejemplo Aguacate)
type EtapaFenologicaAguacate = 'REP' | 'BRO' | 'VEG' | 'IFL' | 'FLO' | 'CUA' | 'DES' | 'MAD' | 'COS';

const COLORES_FENOLOGIA_AGUACATE = {
  'REP': { color: '#8b4513', emoji: 'ğŸŸ¤', nombre: 'Reposo' },
  'BRO': { color: '#90ee90', emoji: 'ğŸŸ¢', nombre: 'BrotaciÃ³n' },
  'VEG': { color: '#228b22', emoji: 'ğŸ’š', nombre: 'Crecimiento Vegetativo' },
  'IFL': { color: '#ffb6c1', emoji: 'ğŸŒ¸', nombre: 'InducciÃ³n Floral' },
  'FLO': { color: '#ff69b4', emoji: 'ğŸŒº', nombre: 'FloraciÃ³n' },
  'CUA': { color: '#98fb98', emoji: 'ğŸŸ¢', nombre: 'Cuajado' },
  'DES': { color: '#7cfc00', emoji: 'ğŸ', nombre: 'Desarrollo Fruto' },
  'MAD': { color: '#32cd32', emoji: 'ğŸ¥‘', nombre: 'MaduraciÃ³n' },
  'COS': { color: '#006400', emoji: 'ğŸ¯', nombre: 'Listo Cosecha' }
};

// Modo: NDVI (gradiente continuo)
function obtenerColorNDVI(ndvi: number): string {
  // NDVI varÃ­a de -1 a 1, pero para vegetaciÃ³n: 0.2 a 0.9
  const normalizado = Math.max(0, Math.min(1, (ndvi - 0.2) / 0.7));
  
  if (normalizado < 0.33) {
    // Rojo a Amarillo (bajo vigor)
    const r = 255;
    const g = Math.floor(255 * (normalizado / 0.33));
    return `rgb(${r}, ${g}, 0)`;
  } else if (normalizado < 0.67) {
    // Amarillo a Verde claro
    const r = Math.floor(255 * (1 - (normalizado - 0.33) / 0.34));
    const g = 255;
    return `rgb(${r}, ${g}, 0)`;
  } else {
    // Verde claro a Verde oscuro (alto vigor)
    const g = 255;
    const b = Math.floor(128 * ((normalizado - 0.67) / 0.33));
    return `rgb(0, ${g}, ${b})`;
  }
}

// FunciÃ³n para obtener emoji NDVI
function obtenerEmojiNDVI(ndvi: number): string {
  if (ndvi < 0.3) return 'ğŸ”´';
  if (ndvi < 0.5) return 'ğŸŸ ';
  if (ndvi < 0.65) return 'ğŸŸ¡';
  if (ndvi < 0.75) return 'ğŸŸ¢';
  return 'ğŸŸ¢';
}
```

#### Modelo de Datos SQL

```sql
-- Estado actual de cada Ã¡rbol (para cuadrÃ­cula)
CREATE TABLE arboles_estado (
    id SERIAL PRIMARY KEY,
    arbol_id INTEGER REFERENCES arboles(id) UNIQUE,
    
    -- Estado de salud
    estado_salud VARCHAR(10) DEFAULT 'SAL',
    fecha_cambio_salud TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    salud_observaciones TEXT,
    
    -- Etapa fenolÃ³gica
    etapa_fenologica VARCHAR(10),
    fecha_cambio_fenologia TIMESTAMP,
    
    -- Ãndices de vegetaciÃ³n (Ãºltimo valor)
    ndvi DECIMAL(5,4),
    fecha_ndvi DATE,
    ndre DECIMAL(5,4),
    gndvi DECIMAL(5,4),
    
    -- ProducciÃ³n
    produccion_kg_actual DECIMAL(8,2),
    fecha_ultima_cosecha DATE,
    
    -- Alertas activas
    tiene_alertas BOOLEAN DEFAULT false,
    alertas_activas INTEGER[] DEFAULT '{}',
    
    -- Metadata
    ultima_inspeccion TIMESTAMP,
    inspeccionado_por INTEGER REFERENCES usuarios(id),
    
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Ãndices
CREATE INDEX idx_arboles_estado_salud ON arboles_estado(estado_salud);
CREATE INDEX idx_arboles_estado_arbol ON arboles_estado(arbol_id);
CREATE INDEX idx_arboles_estado_alertas ON arboles_estado(tiene_alertas);

-- Vista materializada para renderizado rÃ¡pido de cuadrÃ­cula
CREATE MATERIALIZED VIEW vista_cuadricula AS
SELECT 
    l.id AS lote_id,
    l.nombre AS lote_nombre,
    a.id AS arbol_id,
    a.codigo AS arbol_codigo,
    a.fila,
    a.columna,
    ae.estado_salud,
    ae.etapa_fenologica,
    ae.ndvi,
    ae.ndre,
    ae.produccion_kg_actual,
    ae.tiene_alertas,
    ae.ultima_inspeccion,
    EXTRACT(EPOCH FROM (CURRENT_TIMESTAMP - ae.ultima_inspeccion))/86400 AS dias_sin_inspeccion,
    a.fecha_siembra,
    EXTRACT(YEAR FROM AGE(CURRENT_DATE, a.fecha_siembra)) AS edad_anos
FROM arboles a
JOIN lotes l ON a.lote_id = l.id
LEFT JOIN arboles_estado ae ON a.id = ae.arbol_id
WHERE a.estado_vital = 'vivo'
ORDER BY l.id, a.fila, a.columna;

-- Ãndice para bÃºsquedas rÃ¡pidas
CREATE INDEX idx_vista_cuadricula_lote ON vista_cuadricula(lote_id, fila, columna);

-- Refrescar vista materializada (ejecutar periÃ³dicamente)
REFRESH MATERIALIZED VIEW vista_cuadricula;
```

#### Interacciones de Usuario

```yaml
# Click simple en Ã¡rbol
click:
  accion: "Mostrar panel de detalle"
  contenido:
    - CÃ³digo del Ã¡rbol
    - Estado de salud
    - Etapa fenolÃ³gica
    - NDVI actual
    - Ãšltima inspecciÃ³n
    - Alertas activas
    - Historial resumido
    - Botones: [Ver Completo] [Editar] [Registrar InspecciÃ³n]

# Hover sobre Ã¡rbol
hover:
  accion: "Mostrar tooltip"
  contenido: "AGC-001-A-0234 | F2-C34 | SAL | NDVI: 0.78 | Ãšltima inspecciÃ³n: hace 3 dÃ­as"
  delay_ms: 300

# Click + Drag (selecciÃ³n mÃºltiple)
drag:
  accion: "Seleccionar rectÃ¡ngulo de Ã¡rboles"
  opciones:
    - Aplicar operaciÃ³n masiva
    - Exportar selecciÃ³n
    - Crear grupo temporal
    - Programar aplicaciÃ³n

# Click derecho (menÃº contextual)
right_click:
  opciones:
    - "Ver en mapa"
    - "Ver historial completo"
    - "Registrar inspecciÃ³n"
    - "Marcar para tratamiento"
    - "Agregar nota"
    - "Ver fotos"
    - "Generar QR"

# Atajos de teclado
keyboard_shortcuts:
  "Ctrl + F": "Buscar Ã¡rbol por cÃ³digo"
  "Ctrl + Click": "SelecciÃ³n mÃºltiple no consecutiva"
  "Shift + Click": "SelecciÃ³n de rango"
  "Escape": "Cancelar selecciÃ³n"
  "F5": "Refrescar datos"
  "Ctrl + E": "Exportar vista actual"
  "Ctrl + P": "Imprimir cuadrÃ­cula"
  "Arrow Keys": "Navegar entre Ã¡rboles"
  "Enter": "Ver detalle del Ã¡rbol seleccionado"
```

#### Panel de Detalle del Ãrbol

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“‹ DETALLE DEL ÃRBOL                                    [X]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸŒ³ AGC-001-A-0234                                              â”‚
â”‚  Lote A - Fila 2 - Columna 34                                  â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“Š ESTADO ACTUAL                                               â”‚
â”‚  Salud: ğŸŸ¢ Saludable (SAL)                                      â”‚
â”‚  FenologÃ­a: ğŸ¥‘ Desarrollo de Fruto (DES)                        â”‚
â”‚  NDVI: 0.78 (Excelente) ğŸ›°ï¸ hace 1 dÃ­a                          â”‚
â”‚  Edad: 6 aÃ±os 9 meses                                           â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  ğŸ” ÃšLTIMA INSPECCIÃ“N                                           â”‚
â”‚  Fecha: 2025-12-05 09:30                                        â”‚
â”‚  Por: Juan PÃ©rez                                                â”‚
â”‚  Notas: "Buen desarrollo. Frutos 8-10cm. Sin plagas visibles"  â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ ALERTAS (0)                                                 â”‚
â”‚  Sin alertas activas                                            â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“ˆ HISTORIAL RECIENTE                                          â”‚
â”‚  2025-12-05: InspecciÃ³n â†’ SAL                                   â”‚
â”‚  2025-11-28: InspecciÃ³n â†’ SAL                                   â”‚
â”‚  2025-11-15: NDVI: 0.76                                         â”‚
â”‚  2025-11-10: AplicaciÃ³n foliar (NutriciÃ³n)                     â”‚
â”‚                                                                 â”‚
â”‚  [ğŸ“¸ Ver Fotos (3)] [ğŸ“Š Historial Completo] [ğŸ—ºï¸ Ver en Mapa]   â”‚
â”‚  [âœï¸ Editar] [ğŸ“ Nueva InspecciÃ³n] [ğŸ·ï¸ Imprimir QR]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Filtros y BÃºsqueda Disponibles

```yaml
filtros:
  por_estado_salud:
    - SAL (Saludable)
    - OBS (ObservaciÃ³n)
    - RIE (Riesgo)
    - CRI (CrÃ­tico)
    - TRA (En Tratamiento)
    - REC (RecuperaciÃ³n)
    - MÃºltiple selecciÃ³n permitida
  
  por_etapa_fenologica:
    - Opciones segÃºn cultivo
    - Filtro dinÃ¡mico
  
  por_rango_ndvi:
    - Slider: 0.0 - 1.0
    - Presets: Bajo (<0.5), Medio (0.5-0.7), Alto (>0.7)
  
  por_ultima_inspeccion:
    - Ãšltimos 7 dÃ­as
    - Ãšltimos 14 dÃ­as
    - Ãšltimos 30 dÃ­as
    - MÃ¡s de 30 dÃ­as
    - Nunca inspeccionados
  
  por_produccion:
    - Bajo rendimiento (<50 kg)
    - Rendimiento medio (50-100 kg)
    - Alto rendimiento (>100 kg)
    - Sin datos
  
  por_edad:
    - Rango personalizado (aÃ±os)
    - JÃ³venes (<3 aÃ±os)
    - Productivos (3-15 aÃ±os)
    - Maduros (>15 aÃ±os)
  
  por_alertas:
    - Con alertas activas
    - Sin alertas
    - Por tipo de alerta

busqueda:
  por_codigo:
    - BÃºsqueda exacta
    - BÃºsqueda parcial (autocomplete)
  
  por_posicion:
    - Fila especÃ­fica
    - Columna especÃ­fica
    - Rango: F1-5, C10-20
  
  avanzada:
    - CombinaciÃ³n de mÃºltiples criterios
    - Guardar bÃºsquedas frecuentes
```

#### DetecciÃ³n AutomÃ¡tica de Patrones Espaciales

```typescript
interface PatronDetectado {
  tipo: 'foco_plaga' | 'estres_hidrico' | 'deficit_nutricional' | 'patron_edad';
  severidad: 'baja' | 'media' | 'alta';
  arboles_afectados: number[];
  ubicacion: {
    filas: number[];
    columnas: number[];
    centro: { fila: number; columna: number };
  };
  descripcion: string;
  recomendacion: string;
  confianza: number; // 0-1
  fecha_deteccion: Date;
}

// Ejemplo de patrÃ³n detectado
const patron: PatronDetectado = {
  tipo: 'foco_plaga',
  severidad: 'alta',
  arboles_afectados: [234, 235, 236, 244, 245, 246, 254, 255, 256],
  ubicacion: {
    filas: [1, 2, 3],
    columnas: [5, 6, 7, 8],
    centro: { fila: 2, columna: 6 }
  },
  descripcion: 'Cluster de 9 Ã¡rboles con estado CRI/RIE en Ã¡rea contigua',
  recomendacion: 'InspecciÃ³n urgente. Posible foco de Phytophthora. Aplicar fungicida sistÃ©mico.',
  confianza: 0.87,
  fecha_deteccion: new Date('2025-12-08')
};

// Algoritmo de detecciÃ³n (simplificado)
function detectarPatronesEspaciales(cuadricula: Arbol[][]): PatronDetectado[] {
  const patrones: PatronDetectado[] = [];
  
  // Detectar clusters de Ã¡rboles con problemas
  const arbolesProblema = cuadricula.flat().filter(a => 
    ['RIE', 'CRI'].includes(a.estado_salud)
  );
  
  // AnÃ¡lisis de vecindad (8 vecinos)
  for (const arbol of arbolesProblema) {
    const vecinos = obtenerVecinosConProblema(arbol, cuadricula);
    if (vecinos.length >= 3) {
      patrones.push(crearPatronFoco(arbol, vecinos));
    }
  }
  
  return patrones;
}
```

#### ComparaciÃ³n Temporal (Lado a Lado)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š COMPARACIÃ“N TEMPORAL - Lote A                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  2025-11-15 (hace 23 dÃ­as)      |  2025-12-08 (hoy)            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚        Colâ†’ 1  2  3  4  5  6    |      Colâ†’ 1  2  3  4  5  6   â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     |    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚ Fil 1â”‚ ğŸŸ¢ ğŸŸ¢ ğŸŸ¢ ğŸŸ¢ ğŸŸ¢ ğŸŸ¢         | Fil1â”‚ ğŸŸ¢ ğŸŸ¢ ğŸŸ¢ ğŸŸ¢ ğŸŸ¡ ğŸŸ¡       â”‚
â”‚ Fil 2â”‚ ğŸŸ¢ ğŸŸ¢ ğŸŸ¢ ğŸŸ¢ ğŸŸ¡ ğŸŸ¢         | Fil2â”‚ ğŸŸ¢ ğŸŸ¢ ğŸŸ¢ ğŸŸ¡ ğŸŸ¡ ğŸ”´       â”‚
â”‚ Fil 3â”‚ ğŸŸ¢ ğŸŸ¢ ğŸŸ¢ ğŸŸ¢ ğŸŸ¢ ğŸŸ¢         | Fil3â”‚ ğŸŸ¢ ğŸŸ¢ ğŸŸ¡ ğŸŸ¡ ğŸ”´ ğŸ”´       â”‚
â”‚ Fil 4â”‚ ğŸŸ¢ ğŸŸ¢ ğŸŸ¢ ğŸŸ¢ ğŸŸ¢ ğŸŸ¢         | Fil4â”‚ ğŸŸ¢ ğŸŸ¢ ğŸŸ¢ ğŸŸ¡ ğŸŸ  ğŸŸ        â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     |    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                 |                              â”‚
â”‚  ğŸ“Š SAL: 95% | OBS: 5%          |  ğŸ“Š SAL: 74% | OBS-CRI: 26%  â”‚
â”‚  âš ï¸ Sin alertas                 |  âš ï¸ 1 foco detectado         â”‚
â”‚                                 |                              â”‚
â”‚  ğŸ” CAMBIOS DETECTADOS:                                         â”‚
â”‚  â€¢ 8 Ã¡rboles empeoraron de SAL â†’ OBS/RIE/CRI                   â”‚
â”‚  â€¢ Foco emergente en zona [F1-3, C5-6]                         â”‚
â”‚  â€¢ NDVI promedio bajÃ³ de 0.79 a 0.72                           â”‚
â”‚  â€¢ RecomendaciÃ³n: Investigar causa (riego, plaga, enfermedad)  â”‚
â”‚                                                                 â”‚
â”‚  [â—€ Fecha Anterior] [Reproducir Timeline â–¶] [Fecha Siguiente â–¶]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### API de CuadrÃ­cula

```yaml
# Obtener cuadrÃ­cula de un lote
GET /api/v1/cuadricula/{loteId}
  parametros:
    modo: 'salud' | 'fenologia' | 'ndvi' | 'produccion'
    fecha: '2025-12-08' (opcional, por defecto hoy)
  respuesta:
    lote:
      id: 5
      nombre: "Lote A"
      filas: 20
      columnas: 25
      total_arboles: 500
    modo: "salud"
    fecha: "2025-12-08"
    arboles:
      - fila: 1
        columna: 1
        arbol_id: 234
        codigo: "AGC-001-A-0234"
        valor: "SAL"  # segÃºn modo
        color: "#22c55e"
        emoji: "ğŸŸ¢"
        tiene_alertas: false
      - fila: 1
        columna: 2
        arbol_id: 235
        codigo: "AGC-001-A-0235"
        valor: "OBS"
        color: "#eab308"
        emoji: "ğŸŸ¡"
        tiene_alertas: true
    resumen:
      SAL: 370
      OBS: 30
      RIE: 25
      CRI: 10
      TRA: 15
      REC: 10
      MUE: 5
      REM: 0
      NUE: 35
    patrones_detectados:
      - tipo: "foco_plaga"
        severidad: "alta"
        ubicacion: "F1-3, C5-8"
        arboles: 9
        recomendacion: "AplicaciÃ³n urgente"

# Actualizar estado de Ã¡rbol desde cuadrÃ­cula
PATCH /api/v1/cuadricula/arbol/{arbolId}
  body:
    estado_salud: "RIE"
    observaciones: "Hojas con manchas amarillas"
    inspeccionado_por: 123
  respuesta:
    success: true
    arbol_actualizado: {...}
    cuadricula_actualizada: true

# ComparaciÃ³n temporal
GET /api/v1/cuadricula/{loteId}/comparar
  parametros:
    fecha_inicio: '2025-11-15'
    fecha_fin: '2025-12-08'
    modo: 'salud'
  respuesta:
    fecha_inicio: {...}
    fecha_fin: {...}
    cambios:
      arboles_mejorados: 5
      arboles_empeorados: 8
      arboles_sin_cambio: 487
      cambios_detallados: [...]
```

#### Formatos de ExportaciÃ³n

| Formato | DescripciÃ³n | Contenido | Uso |
|---------|-------------|-----------|-----|
| **PNG** | Imagen de la cuadrÃ­cula | VisualizaciÃ³n con colores y leyenda | Reportes, presentaciones |
| **PDF** | Documento imprimible | CuadrÃ­cula + resumen + alertas | ImpresiÃ³n, archivo |
| **Excel** | Hoja de cÃ¡lculo | Matriz con cÃ³digos, estados, NDVI | AnÃ¡lisis offline |
| **GIF Animado** | Secuencia temporal | EvoluciÃ³n de la cuadrÃ­cula en el tiempo | Presentaciones, anÃ¡lisis |
| **JSON** | Datos estructurados | Array de Ã¡rboles con todos los atributos | IntegraciÃ³n con otros sistemas |
| **CSV** | Tabla plana | Lista de Ã¡rboles con coordenadas de cuadrÃ­cula | AnÃ¡lisis estadÃ­stico |

**Ejemplo de exportaciÃ³n Excel:**

```
| Fila | Columna | CÃ³digo       | Estado | NDVI | Ãšltima InspecciÃ³n | Alertas |
|------|---------|--------------|--------|------|-------------------|---------|
| 1    | 1       | AGC-001-A-01 | SAL    | 0.78 | 2025-12-05       | 0       |
| 1    | 2       | AGC-001-A-02 | SAL    | 0.79 | 2025-12-05       | 0       |
| 1    | 3       | AGC-001-A-03 | OBS    | 0.68 | 2025-12-03       | 1       |
```

---

## ğŸ“š Documentos relacionados

- [Coordenadas geogrÃ¡ficas de cada Ã¡rbol](07-01-mapeo-geolocalizacion.md)
- [InspecciÃ³n de Ã¡rboles en campo](07-07-app-movil-campo.md)
- [VisualizaciÃ³n del estado de salud](07-03-salud-fenologia.md)

---

> NavegaciÃ³n: [â† Anterior](07-01-mapeo-geolocalizacion.md) | [ğŸ“‘ Ãndice](../README.md) | [Siguiente â†’](07-03-salud-fenologia.md)
